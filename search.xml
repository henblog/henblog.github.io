<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>kettle使用(1)-更换界面logo和文字</title>
      <link href="/2022/07/10/kettle-1-geng-huan-tu-biao-wen-zi/"/>
      <url>/2022/07/10/kettle-1-geng-huan-tu-biao-wen-zi/</url>
      
        <content type="html"><![CDATA[<h1 id="kettle使用-1-更换界面logo和文字"><a href="#kettle使用-1-更换界面logo和文字" class="headerlink" title="kettle使用(1)-更换界面logo和文字"></a>kettle使用(1)-更换界面logo和文字</h1><p>kettle主要用于ETL，因为操作简单、门槛低被很多企业使用，今天来说一下不修改源码如何更改kettle的logo和其中的文字(包括标题)。</p><p>本文中 <code>kettle安装目录</code> 指代为 <code>%kettle%</code> 。</p><p><strong>在 <code>%kettle%\data-integration\lib\</code> 中找到 <code>kettle-ui-swt-9.3.0.0-428.jar</code> ，使用压缩软件查看。</strong></p><h2 id="修改图标"><a href="#修改图标" class="headerlink" title="修改图标"></a>修改图标</h2><p>替换：自己的图标名称与替换的<strong>名称和扩展名</strong>相同。</p><ul><li>更改logo图标：在<code>ui\images\</code> 找到 <code>spoon.png</code>和 <code>spoon.ico</code> ，将自己的图标按照源文件的像素大小替换(为了更加契合)即可。</li><li>更改tab的图标：在<code>ui\images\</code> 找到 <code>kettle_logo_small.png</code> 和 <code>kettle_logo_small.svg</code> ，注意 <code>svg</code> 格式的文件需要进行格式转换才能得到，在网页中搜索 <code>svg格式转换</code> 转换后替换文件即可。</li><li>启动界面图片：<code>\ui\images\kettle_splash.png</code></li><li>启动界面版本信息：<code>\ui\org\pentaho\di\ui\core\dialog\messages\messages_en_US.properties</code>中的<code>SplashDialog.Version</code><br>启动界面license：<code>\ui\org\pentaho\di\ui\core\dialog\license\license.txt</code></li></ul><p>理论上来说，你在这里找到的图标都可以进行修改替换成自己想要的图片。</p><h2 id="修改文字"><a href="#修改文字" class="headerlink" title="修改文字"></a>修改文字</h2><p>kettle界面中的文字在文件中使用<code>字节码</code>保存的，所以我们在其中搜索和修改都是用<code>字节码</code>格式来进行的，在网页搜索<code>字节码在线转换</code>即可。</p><p>编辑 <code>org\pentaho\di\ui\spoon\messages</code> 下<code>messages_zh_CN.properties</code> ，搜索你要替换的文字，将文字替换即可。标题搜索<code>Spoon.Application.Name</code> 替换内容即可。</p><p>举个例子，现在我将 <code>右键转换弹出的新建</code> 两字替换为 <code>再来一个嘛</code> ：</p><p><img src="/../pic/kettle-1%E6%9B%B4%E6%8D%A2%E5%9B%BE%E6%A0%87%E6%96%87%E5%AD%97/1657431509657.png" alt="1657431509657"></p><ol><li><p>将 <code>新建</code> 转换为<code>ASCII</code>格式 <code>\u65b0\u5efa</code>:</p><p><img src="/../pic/kettle-1%E6%9B%B4%E6%8D%A2%E5%9B%BE%E6%A0%87%E6%96%87%E5%AD%97/1657431563581.png" alt="1657431563581"></p></li><li><p>在<code>messages_zh_CN.properties</code> 中搜索转换后的文字：</p><p><img src="/../pic/kettle-1%E6%9B%B4%E6%8D%A2%E5%9B%BE%E6%A0%87%E6%96%87%E5%AD%97/1657431582300.png" alt="1657431582300"></p><p>注意可能搜索结果不唯一，选择查找结果只有你搜索的内容。</p></li><li><p>将 <code>再来一个嘛</code> 转换为ASCII 格式 <code>\u518d\u6765\u4e00\u4e2a\u561b</code> 后替换：</p><p><img src="/../pic/kettle-1%E6%9B%B4%E6%8D%A2%E5%9B%BE%E6%A0%87%E6%96%87%E5%AD%97/1657431601344.png" alt="1657431601344"></p><p><img src="/../pic/kettle-1%E6%9B%B4%E6%8D%A2%E5%9B%BE%E6%A0%87%E6%96%87%E5%AD%97/1657431620281.png" alt="1657431620281"></p></li><li><p>保存退出查看效果：</p><p><img src="/../pic/kettle-1%E6%9B%B4%E6%8D%A2%E5%9B%BE%E6%A0%87%E6%96%87%E5%AD%97/1657431643972.png" alt="1657431643972"></p></li></ol><p>理论上来说，你在这里找到的文字都可以进行修改替换成自己想要的文字；理论上来说，文字相关的文件都在messages文件夹下。</p><p>更多示例：<a href="http://www.kettle.org.cn/category/demo">kettle示例 – Kettle中文网</a></p>]]></content>
      
      
      <categories>
          
          <category> kettle </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kettle </tag>
            
            <tag> ETL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kettle使用(2)-使用sql脚本和Java脚本</title>
      <link href="/2022/07/10/kettle-2-shi-yong-sql-he-java-jiao-ben/"/>
      <url>/2022/07/10/kettle-2-shi-yong-sql-he-java-jiao-ben/</url>
      
        <content type="html"><![CDATA[<h1 id="kettle使用-2-使用SQL和JAVA脚本"><a href="#kettle使用-2-使用SQL和JAVA脚本" class="headerlink" title="kettle使用(2)-使用SQL和JAVA脚本"></a>kettle使用(2)-使用SQL和JAVA脚本</h1><h2 id="kettle中执行SQL脚本"><a href="#kettle中执行SQL脚本" class="headerlink" title="kettle中执行SQL脚本"></a>kettle中执行SQL脚本</h2><ul><li>在转换中需要勾选 <em><strong>执行每一行* *变量替换</strong></em>；</li><li>SQL中如果字段是字符类型的需要加引号**’?’**;</li><li>SQL中的变量用**?<strong>&#x2F;</strong>${var}**(测试有问题)代替;</li><li><strong>?<strong>为变量时：在</strong>作为参数的字段</strong>中顺序填入变量(需要一一对应)，定义参数需要将文件作为输入，里面的字段值就是参数；</li><li>${var}为变量时：在<strong>转换属性</strong>的<strong>命名参数</strong>中设置变量；</li></ul><h2 id="kettle中执行Java脚本"><a href="#kettle中执行Java脚本" class="headerlink" title="kettle中执行Java脚本"></a>kettle中执行Java脚本</h2><p>添加变量：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Type</span> <span class="token keyword">var</span> <span class="token operator">=</span> <span class="token string">"randtext"</span><span class="token punctuation">;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Fields<span class="token punctuation">.</span>Out</span><span class="token punctuation">,</span><span class="token string">"var"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span><span class="token keyword">var</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//并在底部'字段'中声明变量var对应类型Type</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>获取输入的字段：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Type</span> <span class="token keyword">var</span> <span class="token operator">=</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Fields<span class="token punctuation">.</span>In</span><span class="token punctuation">,</span> <span class="token string">"a_fieldname"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//表中字段名为a_fieldname的字段</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>输出字段：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Fields<span class="token punctuation">.</span>Out</span><span class="token punctuation">,</span> <span class="token string">"output_fieldname"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> <span class="token keyword">var</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="kettle中设置定时"><a href="#kettle中设置定时" class="headerlink" title="kettle中设置定时"></a>kettle中设置定时</h2><p>在作业的<strong>start</strong>组件设置</p><h2 id="连接池"><a href="#连接池" class="headerlink" title="连接池"></a>连接池</h2><p>会在目标数据库生成对应表文件，右上角connect连接就可以了。</p><p>报错：</p><pre class="line-numbers language-none"><code class="language-none">You don&#39;t seem to be getting a connection to the server. Please check the path you&#39;re using and make sure the server is up and running. <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>解决方法：1.是否缺失jar包；2.相关服务是否开启；3.如果没有对应的R_的表，查看对应用户在资源库是否又建表权限，正确赋权后，删掉原来的数据库连接，重新配置repository即可；4.新建数据库重新配置</p>]]></content>
      
      
      <categories>
          
          <category> kettle </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kettle </tag>
            
            <tag> ETL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2022/07/08/hello-world/"/>
      <url>/2022/07/08/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo generate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo deploy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Oracle expdp/impdp总结</title>
      <link href="/2022/07/08/oracle-expdp-impdp-zong-jie/"/>
      <url>/2022/07/08/oracle-expdp-impdp-zong-jie/</url>
      
        <content type="html"><![CDATA[<h1 id="Oracle-expdp-x2F-impdp总结"><a href="#Oracle-expdp-x2F-impdp总结" class="headerlink" title="Oracle expdp&#x2F;impdp总结"></a>Oracle expdp&#x2F;impdp总结</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>数据泵（expdp，impdp）是Oracle 10g时引入的新技术，兼容了之前的数据导出导入工具（exp，imp）大部分功能，并进一步完善，提供了很多新功能以满足复杂的业务需求。区别于传统的exp，imp工具，数据泵相关命令需在数据库<strong>服务端</strong>执行。</p><p>数据泵属于逻辑迁移，可跨操作系统版本，跨数据库版本。高版本兼容低版本，高版本向低版本导数据，导出时需添加低版本的版本号。</p><h2 id="快速开始"><a href="#快速开始" class="headerlink" title="快速开始"></a>快速开始</h2><p>本篇适用于常用的导出导入命令，如果你只想将本库的数据导出到文件然后将文件导入到库，本篇可以作为参考。</p><p>本例将密码为<strong>test</strong>的用户<strong>C##TEST</strong>中的<strong>testcar</strong>表按照<strong>条件</strong>导出到指定目录，并导入后<strong>更名</strong>为<strong>newtestcar</strong>。</p><ol><li><p>在操作系统创建文件目录用来保存导出的dump文件(Windows系统直接图形化建立路径即可)；</p><pre class="line-numbers language-plsql" data-language="plsql"><code class="language-plsql">mkdir <span class="token operator">-</span>p d<span class="token operator">:</span>\test\dump<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>将目录指定为数据库的目录路径对象；</p><pre class="line-numbers language-plsql" data-language="plsql"><code class="language-plsql"><span class="token keyword">create</span> <span class="token keyword">directory</span> dptest02 <span class="token keyword">as</span> <span class="token string">'d:\test\dump'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>为用户赋予读写目录对象的权限；</p><pre class="line-numbers language-plsql" data-language="plsql"><code class="language-plsql"><span class="token keyword">grant</span> <span class="token keyword">read</span><span class="token punctuation">,</span><span class="token keyword">write</span> <span class="token keyword">on</span> <span class="token keyword">directory</span> dptest02 <span class="token keyword">to</span> <span class="token keyword">C</span>##TEST<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>导出；</p><pre class="line-numbers language-basic" data-language="basic"><code class="language-basic">expdp C##TEST<span class="token operator">/</span>test@orcl directory<span class="token operator">=</span>dptest02 tables<span class="token operator">=</span>testcar query<span class="token operator">=</span>\"where car_buy_time between to_date<span class="token punctuation">(</span>'<span class="token number">2018</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span>'<span class="token punctuation">,</span>'yyyy<span class="token operator">-</span>mm<span class="token operator">-</span>dd HH24<span class="token punctuation">:</span>mi<span class="token punctuation">:</span>ss'<span class="token punctuation">)</span> <span class="token operator">and</span> to_date<span class="token punctuation">(</span>'<span class="token number">2019</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">23</span><span class="token punctuation">:</span><span class="token number">59</span><span class="token punctuation">:</span><span class="token number">59</span>'<span class="token punctuation">,</span>'yyyy<span class="token operator">-</span>mm<span class="token operator">-</span>dd HH24<span class="token punctuation">:</span>mi<span class="token punctuation">:</span>ss'<span class="token punctuation">)</span>\" dumpfile<span class="token operator">=</span>testcar%U.dmp parallel<span class="token operator">=</span><span class="token number">10</span> job_name<span class="token operator">=</span>jobtest01<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>导入；</p><pre class="line-numbers language-basic" data-language="basic"><code class="language-basic">impdp C##TEST<span class="token operator">/</span>test directory<span class="token operator">=</span>dp_test01 dumpfile<span class="token operator">=</span>testcar%U.dmp remap_table<span class="token operator">=</span>C##TEST.testcar<span class="token punctuation">:</span>newtestcar<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><p>总文件113G ,条件导出expdp按照条件导出49G用时25分，impdp导入用时26分，并行10个进程，共231938000行；</p><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><h3 id="1、目标新库上的操作"><a href="#1、目标新库上的操作" class="headerlink" title="1、目标新库上的操作"></a>1、目标新库上的操作</h3><p>（1）创建临时表空间</p><pre class="line-numbers language-plsql" data-language="plsql"><code class="language-plsql"><span class="token keyword">create</span> temporary tablespace 用户临时表空间名称 tempfile <span class="token string">'/u01/tablespaces/user_temp.dbf'</span> <span class="token keyword">size</span> <span class="token number">50</span>m autoextend <span class="token keyword">on</span> next <span class="token number">50</span>m maxsize <span class="token number">20480</span>m extent management <span class="token keyword">local</span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>备注：根据实际情况调整表空间大小等参数以及规划临时表空间、回滚表空间等相关规划。</p><p>（2）创建数据表空间</p><pre class="line-numbers language-plsql" data-language="plsql"><code class="language-plsql"><span class="token keyword">create</span> tablespace 用户表空间名称 datafile <span class="token string">'/u01/tablespaces/user_data.dbf'</span> <span class="token keyword">size</span> <span class="token number">50</span>m autoextend <span class="token keyword">on</span> next <span class="token number">50</span>m maxsize <span class="token number">20480</span>m extent management <span class="token keyword">local</span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>（3）建立用户，并指定默认表空间</p><pre class="line-numbers language-none"><code class="language-none">create user 用户名称 identified by 密码 default tablespace 用户表空间名称 temporary tablespace 用户临时表空间名称;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>（4）给用户授予权限</p><pre class="line-numbers language-none"><code class="language-none">grant connect,resource to 用户名1;grant create database link to 用户名;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>注意：赋权给多个用户的情况下，各个用户名称间用,分隔即可。</p><p>（5）登录需要创建dblink的用户，创建dblink</p><pre class="line-numbers language-plsql" data-language="plsql"><code class="language-plsql"><span class="token keyword">CREATE</span> DATABASE LINK DBLink名称 <span class="token keyword">CONNECT</span> <span class="token keyword">TO</span> 用户 <span class="token keyword">IDENTIFIED</span> <span class="token keyword">BY</span> 密码 <span class="token keyword">USING</span> <span class="token string">'(DESCRIPTION =(ADDRESS_LIST =(ADDRESS =(PROTOCOL = TCP)(HOST = XXX.XXX.XXX.XXX)(PORT = 1521)))(CONNECT_DATA =(SERVICE_NAME = 实例名)))'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>注意：创建DBLINK默认是用户级别的，对当前用户有效。只有当需要对所有用户有效时，再建立公有的DBlink对象（pulic参数）。</p><h3 id="2、创建数据备份目录（源库和目标库）"><a href="#2、创建数据备份目录（源库和目标库）" class="headerlink" title="2、创建数据备份目录（源库和目标库）"></a>2、创建数据备份目录（源库和目标库）</h3><p>备份目录需要使用操作系统用户创建一个真实的目录，然后登录oracle dba用户，创建逻辑目录，指向该路径并使用户有对其读写权限。这样oracle才能识别这个备份目录。</p><p>（1）在操作系统上建立真实的目录</p><pre class="line-numbers language-none"><code class="language-none">$ mkdir -p d:\test\dump<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>（2）登录oracle管理员用户</p><pre class="line-numbers language-qlsql" data-language="qlsql"><code class="language-qlsql">SQL&gt; conn &#x2F;as sysdba<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>（3）创建逻辑目录</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">create</span> directory dp_name <span class="token keyword">as</span> <span class="token string">'d:\test\dump'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>查看目录是否已经创建成功：</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> dba_directories<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>5、用sys管理员给指定用户赋予在该目录的操作权限</p><pre class="line-numbers language-plsql" data-language="plsql"><code class="language-plsql"><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">grant</span> <span class="token keyword">read</span><span class="token punctuation">,</span><span class="token keyword">write</span> <span class="token keyword">on</span> <span class="token keyword">directory</span> dp_name <span class="token keyword">to</span> 用户<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="常用语句"><a href="#常用语句" class="headerlink" title="常用语句"></a>常用语句</h2><ul><li>expdp导出</li></ul><pre class="line-numbers language-none"><code class="language-none">1)导出表expdp  tables&#x3D;dbmon.lihaibo_exp dumpfile&#x3D;sms.dmp DIRECTORY&#x3D;dump_dir;2)并发导出parallel，指定job名我们需要特别注意一点，parallel 一定要与 dumpfile&#x3D;...%U.dmp结合 使用，或者有多个表需要同时导出。单表，或者其他诸如network_link方式，指定parallel,也无法开启并发进程expdp scott&#x2F;tiger@orcl directory&#x3D;dpdata1 dumpfile&#x3D;scott3%U.dmp parallel&#x3D;4 job_name&#x3D;scott33)全表expdp scott&#x2F;tiger@orcl TABLES&#x3D;emp,dept dumpfile&#x3D;expdp.dmp DIRECTORY&#x3D;dpdata1;4)导出表，并指定表中的内容expdp scott&#x2F;tiger@orcl directory&#x3D;dpdata1 dumpfile&#x3D;expdp.dmp Tables&#x3D;emp query&#x3D;&quot;WHERE deptno&#x3D;20&quot;;5)导出表空间expdp system&#x2F;manager DIRECTORY&#x3D;dpdata1 DUMPFILE&#x3D;tablespace.dmp TABLESPACES&#x3D;temp,example;6)导出全库expdp system&#x2F;manager DIRECTORY&#x3D;dpdata1 DUMPFILE&#x3D;full.dmp FULL&#x3D;y;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>impdp导入</li></ul><pre class="line-numbers language-none"><code class="language-none">1) 全用户导入impdp scott&#x2F;tiger DIRECTORY&#x3D;dpdata1 DUMPFILE&#x3D;expdp.dmp SCHEMAS&#x3D;scott;2) 用户对象迁移impdp system&#x2F;manager DIRECTORY&#x3D;dump_dir DUMPFILE&#x3D;expdp.dmp TABLES&#x3D;scott.dept REMAP_SCHEMA&#x3D;scott:system; （SCOTT为原用户，system为目标用户）3) 导入指定表空间impdp system&#x2F;manager DIRECTORY&#x3D;dump_dir DUMPFILE&#x3D;tablespace.dmp TABLESPACES&#x3D;example;4) 全库导入impdb system&#x2F;manager DIRECTORY&#x3D;dump_dir DUMPFILE&#x3D;full.dmp FULL&#x3D;y;5) 表已存在的处理impdp system&#x2F;manager DIRECTORY&#x3D;dump_dir DUMPFILE&#x3D;expdp.dmp SCHEMAS&#x3D;system TABLE_EXISTS_ACTION&#x3D;append;6) 表空间迁移impdp system&#x2F;manager directory&#x3D;dump_dir dumpfile&#x3D;remap_tablespace.dmp logfile&#x3D;remap_tablespace.log remap_tablespace&#x3D;A:B (A为原表空间名，B为指定的目标表空间名)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="expdp-x2F-impdp参数说明"><a href="#expdp-x2F-impdp参数说明" class="headerlink" title="expdp&#x2F;impdp参数说明"></a>expdp&#x2F;impdp参数说明</h2><ul><li><p>帮助：</p><blockquote><pre class="line-numbers language-none"><code class="language-none">impdp -helpexpdp help&#x3D;y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></blockquote></li><li><p>ATTACH</p></li></ul><blockquote><pre class="line-numbers language-none"><code class="language-none">作用    当我们使用ctrl+C 退出交互式命令时，可使用attach参数重新进入到交互模式语法    ATTACH&#x3D;[schema_name.]job_name    Schema_name用户名,job_name任务名示例    Expdp scott&#x2F;tiger ATTACH&#x3D;scott.export_job<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><ul><li>CONTENT</li></ul><blockquote><pre class="line-numbers language-none"><code class="language-none">作用    限制了导出的内容，包括三个级别：全部／数据／元数据（结构）语法   CONTENT&#x3D;&#123;ALL | DATA_ONLY | METADATA_ONLY&#125;   ALL           -- 导出所有数据，包括元数据及数据   DATA_ONLY     -- 只导出数据   METADATA_ONLY -- 只包含元数据，就是创建语句示例   Expdp scott&#x2F;tiger DIRECTORY&#x3D;dump DUMPFILE&#x3D;a.dump CONTENT&#x3D;METADATA_ONLY<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><ul><li><strong>DIRECTORY</strong></li></ul><blockquote><pre class="line-numbers language-none"><code class="language-none">作用此路径可以理解为实际绝对路径在oracle数据库里的别名，是导出文件的存储位置    路径的创建： create directory &amp;DIRECTORY_NAME AS &#39;&amp;PATH&#39;;    查看已存在路径： select  * from dba_directories;语法    directory&#x3D;[directory_name]示例    Expdp scott&#x2F;tiger DIRECTORY&#x3D;dump_dir DUMPFILE&#x3D;lhb.dump<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><ul><li><strong>DUMPFILE</strong></li></ul><blockquote><pre class="line-numbers language-none"><code class="language-none">作用    此参数用户命名导出文件，默认是 expdat.dmp. 文件的存储位置如果在文件名前没有指定directory,则会默认存储到directory参数指定的路径下。语法    DUMPFILE&#x3D;[dump_dir:]file_name示例    Expdp scott&#x2F;tiger DIRECTORY&#x3D;dump_dir DUMPFILE&#x3D;dump_dir1:a.dmp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><ul><li>ESTIMATE</li></ul><blockquote><pre class="line-numbers language-none"><code class="language-none">在使用Expdp进行导出时，Expdp需要计算导出数据大小容量，Oracle可以通过两种方式进行容量估算，一种是通过数据块(blocks)数量、一种是通过统计信息中记录的内容(statistics)估算.语法结构：    EXTIMATE&#x3D;&#123;BLOCKS | STATISTICS&#125;示例：    Expdp scott&#x2F;tiger TABLES&#x3D;emp ESTIMATE&#x3D;STATISTICS DIRECTORY&#x3D;dump_dir DUMPFILE&#x3D;halberd.dump    Expdp scott&#x2F;tiger TABLES&#x3D;emp ESTIMATE&#x3D;BLOCKS DIRECTORY&#x3D;dump_dir DUMPFILE&#x3D;halberd.dump<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><ul><li>EXTIMATE_ONLY</li></ul><blockquote><pre class="line-numbers language-none"><code class="language-none">作用    此参数用于统计导出的数据量大小及统计过程耗时长短。语法    EXTIMATE_ONLY&#x3D;&#123;Y | N&#125;示例    Expdp scott&#x2F;tiger ESTIMATE_ONLY&#x3D;y NOLOGFILE&#x3D;y directory&#x3D;dump_dir schemas&#x3D;halberd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><ul><li>EXCLUDE</li></ul><blockquote><pre class="line-numbers language-none"><code class="language-none">作用    此参数用于排除不需要导出的内容，如我们进行全库导出，但是不需要导出用户scott，此时需要在exlude后先指定排除类型为schema,再指定具体的schema。具体使用方法见include参数. EXCLUDE与include的使用方法是一样的语法    EXCLUDE&#x3D;object_type[:name_clause] [,object_type[:name_clause] ]    name_clause        &quot;&#x3D;&#39;object_name&#39;&quot;        &quot;in (&#39;object_name&#39;[,&#39;object_name&#39;,....])&quot;        &quot;in (select_clause) &quot;    Object_type对象类型，如：table,view,procedure,schema等    name_clause指定名称的语句,如果不具体指定是哪个对象，则此类所有对象都不导出, select 语句中表名不要加用户名。用户名，通过schemas 指定。示例    expdp scott&#x2F;tiger DIRECTORY&#x3D;dump_dir DUMPFILE&#x3D;halberd.dup EXCLUDE&#x3D;VIEW    expdp scott&#x2F;tiger DIRECTORY&#x3D;dump_dir DUMPFILE&#x3D;halberd.dup EXCLUDE&#x3D;TABLE:\&quot; IN\(\&#39;TEMP\&#39;,\&#39;GRADE\&#39;\)\&quot;    EXCLUDE&#x3D;TABLE:&quot;&#x3D;&#39;APPLICATION_AUDIT&#39;&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><ul><li>FILESIZE</li></ul><blockquote><pre class="line-numbers language-none"><code class="language-none">作用    用于指定单个导出的数据文件的最大值，与％U一起使用。比如，我们需要导出100G的数据，文件全部存储到一个文件内，在文件传输时，会耗费大量的时间，此时我们就可以使用这个参数，限制每个文件的大小，在传输导出文件时，就可以多个文件同时传送，大大的节省了文件传输时间。提高了工作的效率。语法  FILESIZE&#x3D;integer[B | K | M | G]示例   Expdp scott&#x2F;tiger DIRECTORY&#x3D;dump_dir DUMPFILE&#x3D;halberd%U.dup FILESIZE&#x3D;20g<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><ul><li>FLASHBACK_SCN／FLASHBACK_TIME</li></ul><blockquote><pre class="line-numbers language-none"><code class="language-none">作用    基于undo 及scn号(时间点)进行的数据导出。使用此参数设置会进行flashback query的功能，查询到对应指定的SCN时的数据，然后进行导出。只要UNDO不被覆盖，无论数据库是否重启，都可以进行导出. flashback_time参数与flashback_scn的原理是一样的。在导出的数据里保持数据的一致性是很有必要的。这个。。我想，没谁傻忽忽的把这两个参数一起使用吧？所以我就不提醒你两个参数不可以同时使用了。语法   FLASHBACK_SCN&#x3D;scn_value   FLASHBACK_TIME 有多种设定值的格式：   flashback_time&#x3D;to_timestamp (localtimestamp)   flashback_time&#x3D;to_timestamp_tz (systimestamp)   flashback_time&#x3D;&quot;TO_TIMESTAMP (&quot;&quot;25-08-2003 14:35:00&quot;&quot;， &quot;&quot;DD-MM-YYYY HH24:MI:SS&quot;&quot;)&quot;  使用此格式可能会遇到ORA-39150错误。示例   Expdp scott&#x2F;tiger DIRECTORY&#x3D;dump_dir DUMPFILE&#x3D;halberd.dmp FLASHBACK_SCN&#x3D; 12345567789   Expdp scott&#x2F;tiger DIRECTORY&#x3D;dump_dir DUMPFILE&#x3D;halberd.dmp FLASHBACK_TIME&#x3D; to_timestamp (localtimestamp)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><ul><li>FULL</li></ul><blockquote><pre class="line-numbers language-none"><code class="language-none">作用   指定导出内容为全库导出。这里需要特别注意的是,expdp 不能导出sys用户对象。即使是全库导出也不包含sys用户。语法   FULL&#x3D;&#123;Y | N&#125;示例   expdp \&#39;\&#x2F; as sysdba\&#39; directory&#x3D;dump_dir full&#x3D;y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><ul><li><strong><span id = "include">INCLUDE</span></strong></li></ul><blockquote><pre class="line-numbers language-none"><code class="language-none">作用    限制范围，指定自己想要的内容，比如要导出某个用户的某张表。语法    INCLUDE &#x3D; object_type[:name_clause],object_type[:name_clause]示例    impdp dbmon&#x2F;dbmon_123 directory&#x3D;dump_dir network_link&#x3D;zjzwb2 SCHEMAS&#x3D;AICBS remap_schema&#x3D;aicbs:aicbsb include&#x3D;table:\&quot;IN\(SELECT TABLE_NAME FROM dbmon.TABLES_TOBE_MASKED\)\&quot;  LOGFILE&#x3D;zjzwb.log transform&#x3D;segment_attributes:n    PARFILE中设置:        INCLUDE&#x3D;table:&quot;in(select table_name from dba_tables where owner&#x3D;&#39;AA&#39;)&quot;        INCLUDE&#x3D;TABLE:&quot;IN(&#39;TEST1&#39;,&#39;TEST2&#39;)&quot;    SHELL环境设置:        INCLUDE&#x3D;TABLE:\&quot;IN\(SELECT TABLE_NAME FROM DBA_TABLES WHERE OWNER&#x3D;\&#39;AA\&#39;\)\&quot;        INCLUDE&#x3D;TABLE:\&quot;IN\(\&#39;TEST1\&#39;,\&#39;TEST2\&#39;\)\&quot;说明    当导入命令在目标端发起时，select 子句所涉及的表要在源端，并且dblink 所使用的用户有访问的权限。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><ul><li>JOB_NAME</li></ul><blockquote><pre class="line-numbers language-none"><code class="language-none">作用    指定任务名，如果不指定的话，系统会默认自动命名：SYS_EXPORT_mode_nn语法    JOB_NAME&#x3D;&amp;JOB_NAME其他    查看有哪些expdp&#x2F;impdp job，可以通过dba_datapump_jobs查看，其实你通过v$session.action也可以查看到    大多与attach参数一起使用，重新进行expdp交互命令时使用。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><ul><li><strong>LOGFILE</strong></li></ul><blockquote><pre class="line-numbers language-none"><code class="language-none">作用： 指定导出日志名称。默认是：expdp.log语法    LOGFILE&#x3D;[DIRECTORY:]file_name   , 如果参数值里没有指定路径，会默认使用directory参数值所指向的路径。    directory ： 存储路径,    file_name :日志文件名示例    expdp scott&#x2F;tiger DIRECTORY&#x3D;dump_dir DUMPFILE&#x3D;halberd.dmp logfile&#x3D;halberd.log    impdp scott&#x2F;tiger DIRECTORY&#x3D;dump_dir DUMPFILE&#x3D;halberd.dmp logfile&#x3D;halberd.log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><ul><li><strong>NETWORK_LINK</strong></li></ul><blockquote><pre class="line-numbers language-none"><code class="language-none">作用    此参数只有在导入（impdp）时使用，可通过本地数据库里的db_link连接到其他数据库A，将数据库A的数据直接导入到本地数据库。中间可节省导出数据文件，传送数据文件的过程。很方便。但是要特别注意，不同版本之间可能会存在问题，比如源库为10g,目标库为11g。使用network_link参数会报错。至于 12C 与低版本之间是否有问题尚未尝试。语法    network_link&#x3D;[db_link]示例    impdp scott&#x2F;tiger DIRECTORY&#x3D;dump_dir DUMPFILE&#x3D;halberd.dmp NETWORK_LINK&#x3D;to_tjj SCHEMAS&#x3D;halberd logfile&#x3D;halberd.log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><ul><li>NOLOGFILE</li></ul><blockquote><pre class="line-numbers language-none"><code class="language-none">作用    不写导入导出日志，这个笔者是灰常灰常滴不建议设置为“Y”滴。语法    nologfile&#x3D;[y|n]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></blockquote><ul><li>PARALLEL</li></ul><blockquote><pre class="line-numbers language-none"><code class="language-none">作用    指定导出／导入时使用多少个并发，默认是1,如果是单个表则在dumpfile中使用...%U.dmp语法    parallel&#x3D;[digit]示例    expdp \&#39;\&#x2F; as sysdba\&#39; directory&#x3D;dump_dir schemas&#x3D;halberd dumpfile&#x3D;halberd%U.dmp parallel&#x3D;8 logfile&#x3D;halberd.log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><ul><li>PARFILE</li></ul><blockquote><pre class="line-numbers language-none"><code class="language-none">作用    参数文件，这个参数文件里，存储着一些参数的设置。比如上面说过的，parallel,network_link,等。导出时，可以使用此参数，expdp&#x2F;impdp会自动读取文件中的参数设置，进行操作。语法    PARFILE&#x3D;[directory_path] file_name示例   expdp \&#39;\&#x2F; as sysdba\&#39; parfile&#x3D;halberd.par   cat halberd.par   directory&#x3D;dump_dir                             logfile&#x3D;test.log                               schemas&#x3D;test                                   query&#x3D;&quot;where create_date &gt; last_day(add_months(sysdate,-1)) and create_date &lt;&#x3D; last_day(sysdate)&quot;    transform&#x3D;segment_attributes:n                    network_link&#x3D;to_aibcrm   table_exists_action&#x3D;append                       impdp \&#39;\&#x2F; as sysdba\&#39; parfile&#x3D;test.par<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><ul><li><strong>QUERY</strong></li></ul><blockquote><pre class="line-numbers language-plsql" data-language="plsql"><code class="language-plsql">作用    此参数指定在导入导出时的限制条件，和<span class="token keyword">SQL</span>语句中的 <span class="token string">"where"</span> 语句是一样儿一样儿滴语法    QUERY<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">[</span>schema<span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>table_name<span class="token operator">:</span><span class="token punctuation">]</span> query_clause<span class="token punctuation">,</span> <span class="token punctuation">[</span>schema<span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>table_name<span class="token operator">:</span><span class="token punctuation">]</span> query_clause<span class="token punctuation">,</span>……<span class="token punctuation">)</span>    CONTENT<span class="token operator">=</span>METADATA_ONLY<span class="token punctuation">,</span> EXTIMATE_ONLY＝Y<span class="token punctuation">,</span>TRANSPORT_TABLESPACES<span class="token punctuation">.</span>示例   Expdp scott<span class="token operator">/</span>tiger <span class="token keyword">directory</span><span class="token operator">=</span>dump dumpfiel<span class="token operator">=</span><span class="token keyword">a</span><span class="token punctuation">.</span>dmp Tables<span class="token operator">=</span>emp query<span class="token operator">=</span>\"<span class="token keyword">where</span> car_buy_time <span class="token keyword">between</span> to_date<span class="token punctuation">(</span><span class="token string">'2018-01-01 0:00:00'</span><span class="token punctuation">,</span><span class="token string">'yyyy-mm-dd HH24:mi:ss'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> to_date<span class="token punctuation">(</span><span class="token string">'2019-12-31 23:59:59'</span><span class="token punctuation">,</span><span class="token string">'yyyy-mm-dd HH24:mi:ss'</span><span class="token punctuation">)</span>\"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><ul><li><strong>SCHEMAS</strong></li></ul><blockquote><pre class="line-numbers language-none"><code class="language-none">作用    指定导出／导入哪个用户语法    schemas&#x3D;schema_name[,schemaname,....]示例    expdp \&#39;\&#x2F; as sysdba\&#39; directory&#x3D;dump_dir schemas&#x3D;halberd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><ul><li>REMAP_SCHEMA</li></ul><blockquote><pre class="line-numbers language-none"><code class="language-none"> 只在导入时使用作用    当把用户A的对象导入到用户（其实应该叫schema，将就看吧）B时，使用此参数，可实现要求格式    remap_schema&#x3D;schema1: schema2示例    impdp \&#39;\&#x2F; as sysdba\&#39; directory&#x3D;dump_dir dumpfile&#x3D;halberd.dmp logfile&#x3D;halberd.log remap_schema&#x3D;scott:halberd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><ul><li><strong>TABLES</strong></li></ul><blockquote><pre class="line-numbers language-none"><code class="language-none">作用    指定导出哪些表。格式    TABLES&#x3D;[schema.]table_name[:partition_name][,[schema.]table_name[:partition_name]]说明    Schema 表的所有者；table_name表名；partition_name分区名.可以同时导出不同用户的不同的表示例    expdp \&#39;\&#x2F; as sysdba\&#39; directory&#x3D;dump_dir tables&#x3D;emp.emp_no,emp.dept<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><ul><li><strong>REMAP_TABLE</strong><blockquote><pre class="line-numbers language-none"><code class="language-none">作用    只有在导入时使用，用于将导入的数据表更名。用法    REMAP_TABLE&#x3D;S.a:b说明   S:表所在模式；a: 数据所在的原表空间; b： 目标表空间示例    impdp \&#39;\&#x2F; as sysdba\&#39; directory&#x3D;dump_dir tables&#x3D;emp,dept  remap_table&#x3D;C##TEST.emp:newemp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote></li><li>TABLESPACES</li></ul><blockquote><pre class="line-numbers language-none"><code class="language-none">作用    指定导出／导入哪个表空间。语法    tablespaces&#x3D;tablespace_name[,tablespace_name,....]示例    expdp \&#39;\&#x2F; as sysdba\&#39; directory&#x3D;dump_dir tablespace&#x3D;user<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><ul><li>REMAP_TABLESPACE</li></ul><blockquote><pre class="line-numbers language-none"><code class="language-none">作用    只有在导入时使用，用于进行数据的表空间迁移。 把前一个表空间中的对象导入到冒号后面的表空间用法    remap_tablespace&#x3D;a:b说明   a: 数据所在的原表空间; b： 目标表空间示例   impdp \&#39;\&#x2F; as sysdba\&#39; directory&#x3D;dump_dir tables&#x3D;emp.dept remap_tablespace&#x3D;user:user1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><ul><li>TRANSPORT_FULL_CHECK</li></ul><blockquote><pre class="line-numbers language-none"><code class="language-none">检查需要进行传输的表空间与其他不需要传输的表空间之间的信赖关系，默认为N。当设置为“Y”时，会对表空间之间的信赖关系进行检查，如A（索引表空间）信赖于B（表数据表空间），那么传输A而不传输B，则会出错，相反则不会报错。<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></blockquote><ul><li>TRANSPORT_TABLESPACES</li></ul><blockquote><pre class="line-numbers language-none"><code class="language-none">作用    列出需要进行数据传输的表空间格式     TRANSPORT_TABLESPACES＝tablespace1[,tablespace2,.............]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></blockquote><ul><li>TRANSFORM</li></ul><blockquote><pre class="line-numbers language-none"><code class="language-none">作用  此参数只在导入时使用，是一个用于设定存储相关的参数,有时候也是相当方便的。假如数据对应的表空间都存在的话，就根本用不到这个参数，但是，假如数据存储的表空间不存在，使用此参数导入到用户默认表空间就可以了。更灵活的，可以使用remap_tablespace参数来指定。格式    transform&#x3D;transform_name:value[bject_type]    transform_name &#x3D; [OID | PCTSPACE | SEGMENT_ATTRIBUTES | STORAGE]:[Y|N]    segment attributes:段属性包括物理属性、存储属性、表空间和日志,Y 值按照导出时的存储属性导入，N时按照用户、表的默认属性导入    storage:默认为Y，只取对象的存储属性作为导入作业的一部分    oid:  owner_id,如果指定oid&#x3D;Y(默认)，则在导入过程中将分配一个新的oid给对象表，这个参数我们基本不用管。    pctspace:通过提供一个正数作为该转换的值，可以增加对象的分配尺寸，并且数据文件尺寸等于pctspace的值(按百分比)示例    transform&#x3D;segment_attributes:n --表示将用户所有对象创建到用户默认表空间，而不再考虑原来的存储属性。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><ul><li><strong>VERSION</strong></li></ul><blockquote><pre class="line-numbers language-none"><code class="language-none">此参数主要在跨版本之间进行导数据时使用，更具体一点，是在从高版本数据库导入到低版本数据库时使用,从低版本导入到高版本，这个参数是不可用的。默认值是:compatible。此参数基本在导出时使用，导入时基本不可用。VERSION&#x3D;&#123;COMPATIBLE | LATEST | version_string&#125;COMPATIBLE       ： 以参数compatible的值为准，可以通过show parameter 查看compatible参数的值LATEST           ： 以数据库版本为准version_string   ： 指定版本。如： version&#x3D;10.2.0.1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><ul><li>SAMPLE</li></ul><blockquote><pre class="line-numbers language-none"><code class="language-none">SAMPLE 抽样 给出导出表数据的百分比，参数值可以取.000001~100（不包括100）。不过导出过程不会和这里给出的百分比一样精确，是一个近似值。 格式： SAMPLE&#x3D;[[schema_name.]table_name:]sample_percent 示例： SAMPLE&#x3D;&quot;HR&quot;.&quot;EMPLOYEES&quot;:50<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></blockquote><ul><li><span id="table_exists_action">table_exists_action</span></li></ul><blockquote><pre class="line-numbers language-none"><code class="language-none">此参数只在导入时使用。作用：导入时，假如目标库中已存在对应的表，对于这种情况，提供三种不同的处理方式：append,truncate,skip,replace格式： table_exists_action&#x3D;［append | replace| skip |truncate］说明： append :   追加数据到表中       truncate:  将目标库中的同名表的数据truncate掉。       skip ：      遇到同名表，则跳过，不进行处理，注意：使用此参数值时，与该表相关的所有操作都会skip掉。       replace:    导入过程中，遇到同名表，则替换到目标库的那张表（先drop,再创建）。示例：  table_exists_action&#x3D;replace<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><ul><li>SQLFILE</li></ul><blockquote><pre class="line-numbers language-none"><code class="language-none">只在导入时使用！作用： 使用此参数时，主要是将DMP文件中的metadata语句取出到一个单独的SQLfile中，而数据并不导入到数据库中格式： sqlfile&#x3D;&amp;file_name.sql示例： impdp \&#39;\&#x2F; as sysdba\&#39; directory&#x3D;dump_dir dumpfile&#x3D;halberd.dmp logfile&#x3D;halberd.log sqlfile&#x3D;halberd.sql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></blockquote><ul><li><p>legacy mode </p><p>在11g中，才有这种模式。这种模式里兼容了以前版本中的部分参数，如：consistent,reuse_dumpfiles等（其实我现在也就知道这两个参数，哈哈，以后再遇到再补充）</p></li><li><p>consistent</p></li></ul><blockquote><pre class="line-numbers language-none"><code class="language-none">这个是保持数据一致性的一个参数。在11g中使用时，如果设置 consistent&#x3D;true,则会默认转换成 flashback_time参数，时间设置为命令开始执行的那个时间点。格式： consistent&#x3D;[true|false]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></blockquote><ul><li>reuse_dumpfiles</li></ul><blockquote><pre class="line-numbers language-none"><code class="language-none">作用：重用导出的dmp文件 。假如第一次我们导失败了，虽然导出失败，但是dmp文件 还 是会生成的。在修改导出命令，第二次执行时，就可以 加上这个参数。格式： reuse_dumpfile&#x3D;[true|false]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></blockquote><ul><li>partition_options</li></ul><blockquote><pre class="line-numbers language-none"><code class="language-none">1 NONE 不对分区做特殊处理。在系统上的分区表一样创建。2 DEPARTITION 每个分区表和子分区表作为一个独立的表创建，名字使用表和分区（子分区）名字的组合。3 MERGE 将所有分区合并到一个表 注意：如果导出时使用了TRANSPORTABLE参数，这里就不能使用NONE和MERGE<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></blockquote><h2 id="交互式命令"><a href="#交互式命令" class="headerlink" title="交互式命令"></a><span id="jiaohu">交互式命令</span></h2><ol><li><p>连接到对应的job: </p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">impdp username<span class="token operator">/</span>password attach<span class="token operator">=</span><span class="token operator">&amp;</span>job_nameexpdp username<span class="token operator">/</span>password attach<span class="token operator">=</span><span class="token operator">&amp;</span>job_name<span class="token comment">--jobname可以在运行任务时指定或者使用sql：</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> DBA_DATAPUMP_JOBS<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>查看运行状态： status</p></li><li><p>停止导入导出： kill_job(直接kill 掉进程，不自动退出交互模式)</p></li><li><p>停止导入导出：stop_job（逐一停止job进程的运行，并退出交互模式）</p></li><li><p>修改并发值： parallel</p></li><li><p>退出交互模式： exit &#x2F; exit_client(退出到日志模式，对job无影响)</p></li></ol><h2 id="小技巧"><a href="#小技巧" class="headerlink" title="小技巧"></a>小技巧</h2><h3 id="不生成文件直接导入目标数据库"><a href="#不生成文件直接导入目标数据库" class="headerlink" title="不生成文件直接导入目标数据库"></a>不生成文件直接导入目标数据库</h3><ul><li>创建public dblink；</li></ul><pre class="line-numbers language-plsql" data-language="plsql"><code class="language-plsql"><span class="token keyword">CREATE</span> <span class="token keyword">PUBLIC</span> DATABASE LINK <span class="token operator">&lt;</span>pub_link_test1<span class="token operator">></span><span class="token keyword">CONNECT</span> <span class="token keyword">TO</span> <span class="token operator">&lt;</span>username<span class="token operator">></span> <span class="token keyword">IDENTIFIED</span> <span class="token keyword">BY</span> <span class="token operator">&lt;</span><span class="token string">"密码"</span><span class="token operator">></span><span class="token keyword">USING</span><span class="token string">'(DESCRIPTION =    (ADDRESS_LIST =      (ADDRESS = (PROTOCOL = TCP)(HOST = &lt;localhost>)(PORT = 1521))    )    (CONNECT_DATA =    (SERVER = DEDICATED)      (SERVICE_NAME = ORCL)    ))'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>对DIRECTORY对应目录有<code> </code> <code>READ</code> &#x2F; <code>WRITE</code> &#x2F; <code>UTL_FILE</code> 权限；</li></ul><pre class="line-numbers language-plsql" data-language="plsql"><code class="language-plsql"><span class="token keyword">CREATE</span> <span class="token keyword">DIRECTORY</span> <span class="token operator">&lt;</span>dp_name<span class="token operator">></span> <span class="token keyword">AS</span> <span class="token operator">&lt;</span><span class="token string">'E:\dptest\test1'</span><span class="token operator">></span><span class="token punctuation">;</span><span class="token keyword">GRANT</span> <span class="token keyword">READ</span><span class="token punctuation">,</span><span class="token keyword">WRITE</span> <span class="token keyword">ON</span> <span class="token keyword">DIRECTORY</span> <span class="token operator">&lt;</span>dp_name<span class="token operator">></span> <span class="token keyword">TO</span> <span class="token operator">&lt;</span>username<span class="token operator">></span><span class="token punctuation">;</span><span class="token keyword">GRANT</span> <span class="token keyword">EXECUTE</span> <span class="token keyword">ON</span> SYS<span class="token punctuation">.</span>UTL_FILE <span class="token keyword">TO</span> <span class="token operator">&lt;</span>username<span class="token operator">></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>导入到数据库；</li></ul><pre class="line-numbers language-plsql" data-language="plsql"><code class="language-plsql">impdp <span class="token operator">&lt;</span>username<span class="token operator">></span><span class="token operator">/</span><span class="token operator">&lt;</span>password<span class="token operator">></span><span class="token variable">@orcl</span> <span class="token keyword">directory</span><span class="token operator">=</span><span class="token operator">&lt;</span>dp_name<span class="token operator">></span> tables<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">C</span>##TEST<span class="token punctuation">.</span>testcar要导入的表<span class="token operator">></span> parallel<span class="token operator">=</span><span class="token number">10</span> network_link<span class="token operator">=</span><span class="token operator">&lt;</span>pub_link_test1<span class="token operator">></span> remap_table<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token keyword">C</span>##TEST<span class="token punctuation">.</span>testcar<span class="token operator">:</span>testfullcar改名<span class="token operator">></span> LOGFILE<span class="token operator">=</span>impdp<span class="token punctuation">.</span>log<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>个人测试分开导入导出共花费100min,直接导入数据库40min，速度直接提高2.5倍！</p><ul><li>注意：</li></ul><ol><li>在B服务器数据库创建到A服务器数据库的public db link；</li><li>在system下创建Directory，并赋予其读写权限，同时赋予SYS.UTL_FILE的执行权限；</li><li>执行脚本参数位置。</li></ol><h3 id="导入多张表"><a href="#导入多张表" class="headerlink" title="导入多张表"></a>导入多张表</h3><p>使用**<a href="#include">INCLUDE</a>**参数</p><h3 id="如果存在表将导入文件追加到文件尾-x2F-跳过-x2F-删除"><a href="#如果存在表将导入文件追加到文件尾-x2F-跳过-x2F-删除" class="headerlink" title="如果存在表将导入文件追加到文件尾&#x2F;跳过&#x2F;删除"></a>如果存在表将导入文件追加到文件尾&#x2F;跳过&#x2F;删除</h3><p>使用**<a href="#table_exists_action">table_exists_action</a>**参数：［append | replace| skip |truncate］</p><h3 id="查看进度"><a href="#查看进度" class="headerlink" title="查看进度"></a>查看进度</h3><p>在<a href="#jiaohu">交互式命令</a>里面status可以查看导入百分比等详细信息，导出没有显示百分比；</p><h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><h4 id="1、ORA-39112"><a href="#1、ORA-39112" class="headerlink" title="1、ORA-39112"></a>1、ORA-39112</h4><p>导出正常，导入数据时，只成功导入部分记录等数据，另外的部分提数ora 39112错误，经查是因为导出的用户数据中，有部分记录的表用的索引在另一表空间中，该空间还未创建，所以导致该失败。</p><p>解决方法：在导入时，添加参数：RANSFORM&#x3D;segment_attributes:n ，配合table_exists_action&#x3D;replace参数，重新导入即可。</p><p>RANSFORM&#x3D;segment_attributes:n 在导入时，会将数据导入默认的表空间中。</p><p> 补充，造成该问题的可能原因：</p><pre class="line-numbers language-none"><code class="language-none">1、在原来测试库中，目标schema和别的用户相互授权了，可是你导出的dmp中没有包含所有的用户，导入时对应用户没有创建。2、再就是，表空间问题，测试库中的用户下的某个表的索引没有在他的默认表空间里，这样你要在目标端（这里就是生产环境），创建好对应的表空间，就是说如果你在测试库把a用户的下的某个表的权限授给了b,那么你在把a用户用数据泵倒进生产库时，他会在生产库中检测有没有用户ｂ。也要做相同的操作。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="2、ORA-39346"><a href="#2、ORA-39346" class="headerlink" title="2、ORA-39346"></a>2、ORA-39346</h4><p>导入过程中，遇到错误”  ORA-39346: data loss in character set conversion for object SCHEMA_EXPORT&#x2F;PROCEDURE&#x2F;PROCEDURE  “</p><p>oracle官方的描述如下：</p><ul><li><strong>Description:</strong> data loss in character set conversion for object string</li><li><strong>Cause:</strong> Oracle Data Pump import converted a metadata object from the export database character set into the target database character set prior to processing the object. Some characters could not be converted to the target database character set and so the default replacement character was used.</li><li><strong>Action:</strong> No specific user action is required. This type of data loss can occur if the target database character set is not a superset of the export databases character set.</li></ul><p> 翻译：不需要特定的用户操作。如果目标数据库字符集不是导出数据库字符集的超集，则可能发生此类数据丢失。</p><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ul><li>expdp和impdp是服务端的工具程序，他们只能在Oracle服务端使用，不能在客户端使用。</li><li>impdp&#x2F;expdp组合使用，不可以与exp&#x2F;imp混用。</li><li>导数据之间的数据库字符集必须一致，否则可能出现乱码。</li><li>经过测试一次只能有一个job在运行</li></ul><h2 id="脚本（转自）"><a href="#脚本（转自）" class="headerlink" title="脚本（转自）"></a>脚本（<a href="https://www.cnblogs.com/chinas/p/8300955.html#_label5">转自</a>）</h2><span id="more"></span><pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">#!&#x2F;bin&#x2F;bash##############################################################################脚本功能：#脚本路径：#使用方法：脚本名称 操作类型参数#############################################################################export NLS_LANG&#x3D;american_america.AL32UTF8export ORACLE_HOME&#x3D;&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;12.1.0&#x2F;db_1export ORACLE_SID&#x3D;cyrtestdbexport PATH&#x3D;$PATH:$ORACLE_HOME&#x2F;bin:&#x2F;usr&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;bin:&#x2F;usr&#x2F;bin&#x2F;X11:&#x2F;usr&#x2F;local&#x2F;bin:.v_date&#x3D;&#96;date +%Y%m%d&#96;v_logfile&#x3D;&#96;echo $(basename  $0) | awk -F &quot;.&quot; &#39;&#123;print $1&quot;.log&quot;&#125;&#39;&#96;  #日志文件名称：脚本所在目录下，脚本名称.logv_usr_1&#x3D;&quot;&quot;            #Oracle用户名、密码v_pwd_1&#x3D;&quot;&quot;v_usr_2&#x3D;&quot;&quot;v_pwd_2&#x3D;&quot;&quot;            v_db_instance&#x3D;&quot;&quot;    #数据库实例名v_backup_dir&#x3D;&quot;&quot;        #Oracle备份目录(全局变量)v_oradir_name&#x3D;&quot;&quot;    #v_tmp_space1&#x3D;&quot;&quot;        #临时表空间、表空间、索引表空间v_tmp_space2&#x3D;&quot;&quot;v_space1&#x3D;&quot;&quot;v_space2&#x3D;&quot;&quot;v_idx_space1&#x3D;&quot;&quot;v_idx_space2&#x3D;&quot;&quot;v_max_size&#x3D;&quot;5120m&quot;    #表空间数据文件最大值v_dblink&#x3D;&quot;&quot;            #dblink名称#记录日志record_log()&#123;    echo -e &#96;date &#39;+%Y-%m-%d %H:%M:%S&#39;&#96; $1 | tee -a $&#123;v_logfile&#125;&#125;#用户数据导出exp_usrdata()&#123;    v_exp_usr&#x3D;$1    v_exp_pwd&#x3D;$2    v_oradir_name&#x3D;$3    cd $&#123;v_backup_dir&#125;    [[ -f $&#123;v_exp_usr&#125;&quot;_&quot;$&#123;v_date&#125;&quot;.dmp&quot; ]] &amp;&amp; rm -rf $&#123;v_exp_usr&#125;&quot;_&quot;$&#123;v_date&#125;&quot;.dmp&quot;    expdp $&#123;v_exp_usr&#125;&#x2F;$&#123;v_exp_pwd&#125; DIRECTORY&#x3D;$&#123;v_oradir_name&#125; DUMPFILE&#x3D;$&#123;v_exp_usr&#125;&quot;_&quot;$&#123;v_date&#125;&quot;.dmp&quot; SCHEMAS&#x3D;$&#123;v_exp_usr&#125; LOGFILE&#x3D;$&#123;v_exp_usr&#125;&quot;_&quot;$&#123;v_date&#125;&quot;.log&quot;&#125;#在目标库上创建数据库备份目录create_bankup_dir()&#123;    #创建操作系统物理路径    [[ -d $&#123;v_backup_dir&#125; ]] &amp;&amp; mkdir -p $&#123;v_backup_dir&#125;    sqlplus -S &#x2F; as sysdba &gt;&gt; $&#123;v_logfile&#125; &lt;&lt;EOF    set heading off feedback off verify off    spool tmp_space_flag.tmp    grant read,write on directory &#39;$&#123;v_oradir_name&#125;&#39; to &#39;$&#123;v_usr_1&#125;&#39;,&#39;$&#123;v_usr_2&#125;&#39;;    spool off    exit;EOF    ##如果当前表空间不存在，则创建，否则退出当前函数    if [[ &#96;grep $&#123;v_oradir_name&#125; tmp_space_flag.tmp | wc -l&#96; -eq 0 ]]; then        record_log &quot;创建备份目录&quot;$1&quot;开始&quot;        sqlplus -S &#x2F; as sysdba &gt;&gt; $&#123;v_logfile&#125; &lt;&lt;EOF        set heading off feedback off verify off        grant read,write on directory &#39;$&#123;v_oradir_name&#125;&#39; to &#39;$&#123;v_usr_1&#125;&#39;,&#39;$&#123;v_usr_2&#125;&#39;;        exit;EOF        record_log &quot;创建备份目录&quot;$1&quot;结束&quot;    else        record_log &quot;创建备份目录&quot;$1&quot;已存在&quot;        return    fi    ##注意清理临时标志文件    [[ -f .&#x2F;tmp_space_flag.tmp ]] &amp;&amp; rm -rf tmp_space_flag.tmp&#125;#创建表空间create_space()&#123;    v_space_name&#x3D;$1    #判断表空间类型（临时表空间或普通表空间）    if [[ &#96;grep TMP $1&#96; -eq 1 ]]; then        v_space_type&#x3D;&quot;temporary&quot;    else        v_space_type&#x3D;&quot;&quot;    fi     sqlplus -S &#x2F; as sysdba &gt;&gt; $&#123;v_logfile&#125; &lt;&lt;EOF    set heading off feedback off verify off    create &#39;$&#123;v_space_type&#125;&#39; tablespace &#39;$&#123;v_space_name&#125;&#39; tempfile &#39;$&#123;v_backup_dir&#125;&#x2F;$&#123;v_space_name&#125;.dbf&#39; size 50m autoextend on next 128k maxsize &#39;$&#123;v_max_size&#125;&#39; extent management local;     exit;EOF&#125;#判断表空间是否存在，若表空间不存在则创建deal_spaces()&#123;    v_space_name&#x3D;$1    sqlplus -S &#x2F; as sysdba &lt;&lt;EOF     set heading off feedback off verify off    spool tmp_space_flag.tmp    select tablespace_name from dba_tablespaces where tablespace_name&#x3D;&#39;$&#123;v_space_name&#125;&#39;;    spool off    exit;EOF    ##如果当前表空间不存在，则创建，否则退出当前函数    if [[ &#96;grep $&#123;v_space_name&#125; tmp_space_flag.tmp | wc -l&#96; -eq 0 ]]; then        record_log &quot;创建表空间&quot;$1&quot;开始&quot;        create_space $&#123;v_space_name&#125;        record_log &quot;创建表空间&quot;$1&quot;结束&quot;    else        record_log &quot;表空间&quot;$1&quot;已存在&quot;        return    fi    ##注意清理临时标志文件    [[ -f .&#x2F;tmp_space_flag.tmp ]] &amp;&amp; rm -rf tmp_space_flag.tmp&#125;#在目标库上创建用户并赋权create_usrs()&#123;    v_create_usr&#x3D;$1        #参数1：用户名    v_create_pwd&#x3D;$2        #参数2：密码    v_create_tmp_space&#x3D;$3         #参数3：临时表空间名称    v_create_space&#x3D;$4        #参数4：表空间名称    sqlplus -S &#x2F; as sysdba &gt;&gt; $&#123;v_logfile&#125; &lt;&lt;EOF    set heading off feedback off verify off    create user &#39;$&#123;v_create_usr&#125;&#39; identified by &#39;$&#123;v_create_pwd&#125;&#39; default tablespace &#39;$&#123;v_create_space&#125;&#39; temporary tablespace &#39;$&#123;v_create_tmp_space&#125;&#39;;    grant connect,resource to &#39;$&#123;v_create_usr&#125;&#39;;    grant exp_full_database to &#39;$&#123;v_create_usr&#125;&#39;;    grant imp_full_database to &#39;$&#123;v_create_usr&#125;&#39;;    grant unlimited tablespace to &#39;$&#123;v_create_usr&#125;&#39;;    exit;EOF&#125;#用户数据导入imp_usrdata()&#123;    v_imp_usr&#x3D;$1    v_imp_pwd&#x3D;$2    v_oradir_name&#x3D;$3    impdp $&#123;v_imp_usr&#125;&#x2F;$&#123;v_imp_pwd&#125; DIRECTORY&#x3D;$&#123;v_oradir_name&#125; DUMPFILE&#x3D;$&#123;v_imp_usr&#125;&quot;_&quot;$&#123;v_date&#125;&quot;.dmp&quot; SCHEMAS&#x3D;$&#123;v_imp_usr&#125; LOGFILE&#x3D;$&#123;v_imp_usr&#125;&quot;_&quot;$&#123;v_date&#125;&quot;.log&quot; table_exists_action&#x3D;replace RANSFORM&#x3D;segment_attributes:n&#125;#删除用户drop_user()&#123;    v_drop_usr&#x3D;$1    #删除用户及用户下的所有数据，删除表空间及表空间下的所有数据    sqlplus -S &#x2F; as sysdba &gt;&gt; $&#123;v_logfile&#125; &lt;&lt;EOF    set heading off feedback off verify off    drop user &#39;$&#123;v_drop_usr&#125;&#39; cascade;    exitEOF&#125;#删除表空间并删除表空间下的数据文件drop_tablespace()&#123;    v_drop_space&#x3D;$1    #删除用户及用户下的所有数据，删除表空间及表空间下的所有数据    sqlplus -S &#x2F; as sysdba &gt;&gt; $&#123;v_logfile&#125; &lt;&lt;EOF    set heading off feedback off verify off    drop tablespace &#39;$&#123;v_drop_space&#125;&#39; including contents and datafiles;    exitEOF    ##操作系统上表空间下的数据文件    [[ -f $&#123;v_backup_dir&#125;&#x2F;$&#123;v_drop_space&#125;.dbf ]] &amp;&amp; rm -rf $&#123;v_backup_dir&#125;&#x2F;$&#123;v_drop_space&#125;.dbf&#125;#创建dblinkcreate_dblink()&#123;    v_clink_usr&#x3D;$1    v_clink_pwd&#x3D;$2    #以管理员身份对创建dblink赋权    sqlplus -S &#x2F; as sysdba &gt;&gt; $&#123;v_logfile&#125; &lt;&lt;EOF    set heading off feedback off verify off    grant create database link to &#39;$&#123;v_clink_usr&#125;&#39;;    exit;EOF    #以普通用户登录创建dblink    sqlplus -S $&#123;v_clink_usr&#125;&#x2F;$&#123;v_clink_pwd&#125;@$&#123;v_db_instance&#125; &gt;&gt; $&#123;v_logfile&#125; &lt;&lt;EOF    set heading off feedback off verify off    CREATE DATABASE LINK $&#123;v_dblink&#125; CONNECT TO &#39;$&#123;v_clink_usr&#125;&#39; IDENTIFIED BY &#39;$&#123;v_clink_pwd&#125;&#39; USING &#39;&#123;v_db_instance&#125;&#39;;    exitEOF&#125;#判断dblink是否存在deal_dblink()&#123;    v_link&#x3D;$1    v_link_usr&#x3D;$2    v_link_pwd&#x3D;$3    sqlplus -S &#x2F; as sysdba &lt;&lt;EOF     set heading off feedback off verify off    spool tmp_space_flag.tmp    select object_name from dba_objects where object_name &#x3D; &#39;$&#123;v_link&#125;&#39;;     spool off    exit;EOF    ##如果当前dblink不存在，则创建，否则退出当前函数    if [[ &#96;grep $&#123;v_space_name&#125; tmp_space_flag.tmp | wc -l&#96; -eq 0 ]]; then        record_log &quot;创建&quot;$1&quot;开始&quot;        create_dblink $&#123;v_link_usr&#125; $&#123;v_link_pwd&#125;        record_log &quot;创建&quot;$1&quot;结束&quot;    else        record_log $1&quot;已存在&quot;        return    fi    ##注意清理临时标志文件    [[ -f .&#x2F;tmp_space_flag.tmp ]] &amp;&amp; rm -rf tmp_space_flag.tmp&#125;#主函数main()&#123;    v_start&#x3D;&#96;date +%s&#96;    if [[ $1 -eq &quot;exp&quot; ]]; then         record_log &quot;bl库导出开始...&quot;        exp_usrdata $&#123;v_usr_1&#125; $&#123;v_pwd_1&#125; $&#123;v_oradir_name&#125;        record_log &quot;bl库导出结束...&quot;        record_log &quot;hx库导出开始...&quot;        exp_usrdata $&#123;v_usr_2&#125; $&#123;v_pwd_2&#125; $&#123;v_oradir_name&#125;        record_log &quot;hx库导出结束...&quot;    elif [[ $1 -eq &quot;pre&quot; ]]; then        #1、创建备份目录        create_bankup_dir        #2、创建表空间        for v_sp in $&#123;v_tmp_space1&#125; $&#123;v_tmp_space2&#125; $&#123;v_space1&#125; $&#123;v_space2&#125; $&#123;v_idx_space1&#125; $&#123;v_idx_space2&#125;; do            deal_spaces $&#123;v_sp&#125;        done        #3、创建用户、赋权        record_log &quot;创建用户开始...&quot;        create_usrs $&#123;v_usr_1&#125; $&#123;v_pwd_1&#125; $&#123;v_tmp_space1&#125; $&#123;v_space1&#125;        create_usrs $&#123;v_usr_2&#125; $&#123;v_pwd_2&#125; $&#123;v_tmp_space2&#125; $&#123;v_space2&#125;        record_log &quot;创建用户结束...&quot;        #4、为hx库创建dblink        record_log &quot;创建dblink开始...&quot;        deal_dblink $&#123;v_dblink&#125; $&#123;v_usr_2&#125; $&#123;v_pwd_2&#125;        record_log &quot;创建dblink结束...&quot;    elif [[ $1 -eq &quot;imp&quot; ]]; then        record_log &quot;bl库导入开始...&quot;        imp_usrdata $&#123;v_usr_1&#125; $&#123;v_pwd_1&#125; $&#123;v_oradir_name&#125;        record_log &quot;bl库导入结束...&quot;        record_log &quot;hx库导入开始...&quot;        imp_usrdata $&#123;v_usr_2&#125; $&#123;v_pwd_2&#125; $&#123;v_oradir_name&#125;        record_log &quot;hx库导入结束...&quot;    elif [[ $1 -eq &quot;clean&quot; ]]; then        read -t 5 -p &quot;确认清除 0-否 1-是&quot; v_num        if [[ $&#123;v_num&#125; -eq 1 ]]; then            record_log &quot;清理数据文件开始...&quot;            for m in $&#123;&#125; $&#123;&#125;; do                drop_user $&#123;m&#125;            done            for n in $&#123;v_tmp_space1&#125; $&#123;v_tmp_space2&#125; $&#123;v_space1&#125; $&#123;v_space2&#125; $&#123;v_idx_space1&#125; $&#123;v_idx_space2&#125;; do                drop_tablespace $&#123;n&#125;            done            record_log &quot;清理数据文件结束...&quot;        else            exit        fi    else        echo &quot;Usage: sh script [exp|clean|pre|imp]&quot;        exit    fi    v_end&#x3D;&#96;date +%s&#96;    v_use_time&#x3D;$[ v_end - v_start ]    record_log &quot;本次脚本运行时间：&quot;$&#123;v_use_time&#125;&quot;秒&quot;&#125;main<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Oracle </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oracle </tag>
            
            <tag> 数据迁移 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
